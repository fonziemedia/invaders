!function(){$(document).ready(function(){function a(){!x.keys[13]&&!C||!x.start||x.gameOver||x.gameWon||(x.paused=!1,x.start=!1,C=0,q()),x.keys[27]&&(x.lives=0),x.keys[119]&&(x.sound=x.sound?!1:!0,x.keys[119]=!1,q()),!x.keys[80]||x.gameWon||x.gameOver||(x.paused=x.paused?!1:!0,x.keys[80]=!1),(x.keys[27]||(x.keys[13]||C)&&x.paused&&!x.start&&x.gameOver&&!x.gameWon||(x.keys[13]||C)&&x.paused&&!x.start&&x.level>=7)&&((x.lives<1||x.level>=7)&&(x.level=X_Level,x.score=0,x.lives=X_Lives,x.downDivision=Math.floor(300*x.level)),m()),(x.keys[13]||C)&&!x.gameOver&&!x.start&&x.gameWon&&x.level<=6&&(x.downDivision=Math.floor(300*x.level),m())}function b(){l(1),x.downCount>1e5&&(x.downCount=0),x.downCount++,x.shootTimer>0&&x.shootTimer--,x.enshootTimer>0&&x.enshootTimer--;for(var a in x.stars)x.stars[a].y<=-5&&x.stars.splice(a,1),x.stars[a].y--;!C||x.paused||x.gameOver||x.gameWon||A>x.player.size/4&&A<=x.width-x.player.size/4&&B>x.player.size&&B<=x.height-x.player.size/6&&(moveRight1=A>D&&D+2>=A?!0:!1,moveRight2=A>D+2&&D+4>=A?!0:!1,moveRight3=A>D+4&&D+6>=A?!0:!1,moveRight4=A>D+6&&D+8>=A?!0:!1,moveRight5=A>D+8?!0:!1,moveLeft1=D>A&&A>=D-2?!0:!1,moveLeft2=D-2>A&&A>=D-4?!0:!1,moveLeft3=D-4>A&&A>=D-6?!0:!1,moveLeft4=D-6>A&&A>=D-8?!0:!1,moveLeft5=D-8>A?!0:!1,x.player.x=A-x.player.size/2,x.player.y=B-1.2*x.player.size,x.player.image=moveRight1?4:moveRight2?5:moveRight3?6:moveRight4?7:moveRight5?8:moveLeft1?9:moveLeft2?10:moveLeft3?11:moveLeft4?12:moveLeft5?13:0,x.player.rendered=!1,D=A),C||x.gameOver||(x.player.image=0,x.player.rendered=!1),(x.keys[37]||x.keys[65]&&!x.gameOver&&!x.gameWon)&&x.player.x>x.player.size/50&&(x.player.x-=x.player.speed,x.player.image=13,x.player.rendered=!1),(x.keys[39]||x.keys[68]&&!x.gameOver&&!x.gameWon)&&x.player.x<=x.width-x.player.size&&(x.player.x+=x.player.speed,x.player.image=8,x.player.rendered=!1),(x.keys[38]||x.keys[87]&&!x.gameOver&&!x.gameWon)&&x.player.y>x.player.size/12&&(x.player.y-=x.player.speed,x.player.rendered=!1),(x.keys[40]||x.keys[83]&&!x.gameOver&&!x.gameWon)&&x.player.y<=x.height-x.player.size&&(x.player.y+=x.player.speed,x.player.rendered=!1),x.downCount%x.downDivision===0&&(x.down=!0);for(var b in x.enemies)x.enemies[b].dead||(x.enemies[b].x>=.9*x.width&&(x.left=!0),x.enemies[b].x<=.1*x.width&&(x.left=!1),x.down||(x.left?x.enemies[b].x-=x.enemySpeed:x.enemies[b].x+=x.enemySpeed),x.down&&(x.enemies[b].y+=x.enemySpeed),x.enemies[b].y>=x.height-x.player.size&&!x.gameOver&&(x.contextPlayer.clearRect(x.player.x,x.player.y,x.player.size,x.player.size),n(x.player.x,x.player.y),s()),!r(x.player,x.enemies[b])||x.enemies[b].dead||x.gameOver||(n(x.player.x,x.player.y),n(x.enemies[b].x,x.enemies[b].y),s(),x.contextEnemies.clearRect(x.enemies[b].x,x.enemies[b].y,x.enemies[b].size,x.enemies[b].size),x.enemies[b].dead=!0,x.enemies.splice(b,1)),x.enemies.length>0&&x.enshootTimer<=0&&!x.paused&&(p(),x.enshootTimer=x.enfullShootTimer));if(!x.gameOver)for(var c in x.explosions)x.down||(x.left?x.explosions[c].x-=x.enemySpeed/2:x.explosions[c].x+=x.enemySpeed/2),x.down&&(x.explosions[c].y+=x.enemySpeed/2);for(var d in x.projectiles)x.projectiles[d].y-=x.player.bulletspeed,x.projectiles[d].y<=2*-x.projectiles[d].size&&x.projectiles.splice(d,1);for(var e in x.enprojectiles)x.enprojectiles[e].y+=x.EnBulletSpeed,x.level>=4&&x.enprojectiles[e].y<=x.player.y&&(x.enprojectiles[e].x>=x.player.x?x.enprojectiles[e].x-=2:x.enprojectiles[e].x+=2),x.enprojectiles[e].y>=x.height+.05*x.height&&x.enprojectiles.splice(e,1);(x.keys[32]||C)&&x.shootTimer<=0&&!x.gameOver&&(o(),"ON"==x.soundStatus&&x.shootSound.play(),x.shootTimer=x.fullShootTimer);for(var f in x.enemies)for(var g in x.projectiles)r(x.enemies[f],x.projectiles[g])&&!x.enemies[f].dead&&("ON"==x.soundStatus&&x.enemyexplodeSound.play(),x.projectiles.splice(g,1),x.enemies[f].dead=!0,x.player.crashed||(x.score++,x.levelScore++),n(x.enemies[f].x,x.enemies[f].y),q());for(var h in x.enemies)x.enemies[h].dead&&(x.contextEnemies.clearRect(x.enemies[h].x,x.enemies[h].y,x.enemies[h].size,x.enemies[h].size),x.enemies.splice(h,1));for(var i in x.enprojectiles)r(x.player,x.enprojectiles[i])&&!x.gameOver&&(x.enprojectiles.splice(i,1),x.contextPlayer.clearRect(x.player.x,x.player.y,x.player.size,x.player.size),n(x.player.x,x.player.y),s());x.enemies.length<=0&&!x.gameOver&&!x.gameWon&&x.delayTimer<50&&(x.delayTimer++,x.delayTimer>=50&&("ON"==x.soundStatus&&x.winSound.play(),x.level++,x.gameWon=!0,x.paused=!0,x.delayTimer=0,C=0))}function c(){x.contextBackground.clearRect(0,0,x.width,x.height),x.contextEnemies.clearRect(0,0,x.width,x.height);for(var a in x.stars){var b=x.stars[a];x.contextBackground.drawImage(x.images[b.image],b.x,b.y,b.size,b.size)}x.player.rendered||x.paused||(x.contextPlayer.clearRect(0,0,x.width,x.height),x.gameOver||(x.contextPlayer.drawImage(x.images[x.player.image],x.player.x,x.player.y,x.player.size,x.player.size),x.player.rendered=!0));for(var c in x.enemies){var d=x.enemies[c];x.contextEnemies.clearRect(d.x-.1*d.size,d.y-.1*d.size,1.8*d.size,1.1*d.size),x.contextEnemies.drawImage(x.images[d.image],d.x,d.y,d.size,d.size)}for(var e in x.explosions){for(var f=x.explosions[e],g=Math.floor(x.images[f.image].width/f.frameWidth),h=f.startFrame;h<=f.endFrame;h++)f.animationSequence.push(h);f.counter==f.frameSpeed-1&&(f.currentFrame=(f.currentFrame+1)%f.animationSequence.length),f.counter=(f.counter+1)%f.frameSpeed;var i=Math.floor(f.animationSequence[f.currentFrame]/g),j=Math.floor(f.animationSequence[f.currentFrame]%g);f.currentFrame<=19&&x.contextPlayer.drawImage(x.images[f.image],j*f.frameWidth,i*f.frameHeight,f.frameWidth,f.frameHeight,f.x,f.y,f.size,f.size)}for(var k in x.explosions)19==x.explosions[k].currentFrame&&x.explosions.splice(k,1);for(var l in x.projectiles){for(var m=x.projectiles[l],n=Math.floor(x.images[m.image].width/m.frameWidth),o=m.startFrame;o<=m.endFrame;o++)m.animationSequence.push(o);m.counter==m.frameSpeed-1&&(m.currentFrame=(m.currentFrame+1)%m.animationSequence.length),m.counter=(m.counter+1)%m.frameSpeed;var p=Math.floor(m.animationSequence[m.currentFrame]/n),q=Math.floor(m.animationSequence[m.currentFrame]%n);x.contextPlayer.drawImage(x.images[m.image],q*m.frameWidth,p*m.frameHeight,m.frameWidth,m.frameHeight,m.x,m.y,m.size,m.size)}for(var r in x.enprojectiles){for(var s=x.enprojectiles[r],t=Math.floor(x.images[s.image].width/s.frameWidth),u=s.startFrame;u<=s.endFrame;u++)s.animationSequence.push(u);s.counter==s.frameSpeed-1&&(s.currentFrame=(s.currentFrame+1)%s.animationSequence.length),s.counter=(s.counter+1)%s.frameSpeed;var v=Math.floor(s.animationSequence[s.currentFrame]/t),w=Math.floor(s.animationSequence[s.currentFrame]%t);x.contextPlayer.drawImage(x.images[s.image],w*s.frameWidth,v*s.frameHeight,s.frameWidth,s.frameHeight,s.x,s.y,s.size,s.size)}x.gameWon&&x.level>1&&x.level<=6&&(x.contextPlayer.font="bold "+.08*x.width+"px "+x.font,x.contextPlayer.fillStyle="#FFD455",x.contextPlayer.fillText("Battle Won!",.3*x.width,.42*x.height),x.contextPlayer.font="bold "+.06*x.width+"px "+x.font,x.contextPlayer.fillText(x.levelScore+" enemy ships destroyed",.19*x.width,.52*x.height),x.contextPlayer.font="bold "+.04*x.width+"px "+x.font,x.contextPlayer.fillStyle="white",navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?x.contextPlayer.fillText("Tap screen to continue",.3*x.width,.62*x.height):x.contextPlayer.fillText("Press Enter or LMB to continue",.23*x.width,.62*x.height),x.levelScore=0),x.gameWon&&x.level>=7&&(x.contextPlayer.font="bold "+.08*x.width+"px "+x.font,x.contextPlayer.fillStyle="#CC99FF",x.contextPlayer.fillText("Victory!",.35*x.width,.42*x.height),x.contextPlayer.font="bold "+.06*x.width+"px "+x.font,x.contextPlayer.fillText(x.score+" enemy ships destroyed",.17*x.width,.52*x.height),x.contextPlayer.font="bold "+.04*x.width+"px "+x.font,x.contextPlayer.fillStyle="white",navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?x.contextPlayer.fillText("Tap screen to restart",.3*x.width,.62*x.height):x.contextPlayer.fillText("Press Enter or LMB to restart",.24*x.width,.62*x.height),x.levelScore=0)}function d(){y=document.getElementById("playerCanvas"),z=y.getContext("2d"),y.addEventListener("mousedown",g,!1),y.addEventListener("mouseup",e,!1),y.addEventListener("mousemove",j,!1),y.addEventListener("touchstart",h,!1),y.addEventListener("touchend",f,!1),y.addEventListener("touchcancel",f,!1),y.addEventListener("touchleave",f,!1),y.addEventListener("touchmove",k,!1)}function e(){C=0,j()}function f(){C=0}function g(){C=1,j()}function h(){C=1,k()}function j(a){a&&(a.preventDefault(),A=a.pageX-y.offsetLeft,B=a.pageY-y.offsetTop)}function k(a){a&&(a.preventDefault(),A=a.targetTouches[0].pageX-y.offsetLeft,B=a.targetTouches[0].pageY-y.offsetTop)}function l(a){for(var b=0;a>b;b++)x.stars.push({x:Math.floor(Math.random()*x.width),y:x.height+10,size:Math.random()*x.width*.003,image:Math.floor(6*Math.random()+14)})}function m(){C=0,x.gameOver=!1,x.gameWon=!1,x.downCount=1,x.left=!1,x.down=!1,x.enshootTimer=x.enfullShootTimer,x.contextBackground.clearRect(1,1,x.width,x.height),x.contextPlayer.clearRect(1,1,x.width,x.height),x.contextEnemies.clearRect(1,1,x.width,x.height),x.contextText.clearRect(1,1,x.width,x.height),x.projectiles=[],x.enprojectiles=[],x.enemies=[];for(var a=0;a<x.level;a++)for(var b=0;b<x.level;b++)x.enemies.push({x:.05*x.width+.15*b*x.width,y:.1*x.height+a*x.player.size,size:.06*x.height,image:1,dead:!1,deadTime:60});x.player={x:.46*x.width,y:.9*x.height,size:.08*x.height,speed:X_PlayerSpeed,bulletspeed:X_BulletSpeed*x.height/1e3,image:0,rendered:!1,crashed:!1},x.paused=!1,q()}function n(a,b){x.explosions.push({x:a,y:b,frameWidth:96,frameHeight:96,size:.07*x.height,startFrame:0,endFrame:19,frameSpeed:2,animationSequence:[],currentFrame:0,counter:0,image:3}),"ON"==x.soundStatus&&x.enemyexplodeSound.play()}function o(){x.projectiles.push({x:x.player.x+.4*x.player.size,y:x.player.y-1.8*x.player.bulletspeed,size:.022*x.height,frameWidth:48,frameHeight:48,startFrame:0,endFrame:11,frameSpeed:4,animationSequence:[],currentFrame:0,counter:0,image:2})}function p(){xEn=x.enemies.length,pEn=xEn<2?0:Math.floor(Math.random()*(xEn-1+1)),x.enprojectiles.push({x:x.enemies[pEn].x+.42*x.enemies[pEn].size,y:x.enemies[pEn].y+x.enemies[pEn].size,size:.035*x.height,frameWidth:64,frameHeight:64,startFrame:0,endFrame:2,frameSpeed:5,animationSequence:[],currentFrame:0,counter:0,image:20})}function q(){for(x.contextText.fillStyle="#FFD455",x.contextText.font=.025*x.height+"px helvetica",x.contextText.clearRect(0,0,x.width,.1*x.height),x.contextText.fillText("Level: "+x.level,.03*x.height,.04*x.height),x.contextText.fillText("Score: "+x.score,.15*x.height,.04*x.height),x.soundStatus=x.sound?"ON":"OFF",navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)||x.contextText.fillText("Sound(F8): "+x.soundStatus,x.width-.45*x.height,.04*x.height),x.contextText.fillText("Hangar: ",x.width-.22*x.height,.04*x.height),i=0;i<x.lives;i++)x.contextText.drawImage(x.images[0],i*x.height*.03+x.width-.12*x.height,.015*x.height,.035*x.height,.035*x.height)}function r(a,b){return!(a.x>b.x+b.size||a.x+a.size<b.x||a.y>b.y+b.size||a.y+a.size<b.y)}function s(){"ON"==x.soundStatus&&x.playerexplodeSound.play(),x.player.crashed=!0,x.gameOver=!0,x.lives--,x.score=x.score-x.levelScore,q(),setTimeout(function(){x.paused=!0,C=0,x.gameOver&&x.paused&&x.lives<1&&(x.contextPlayer.font="bold "+.08*x.width+"px "+x.font,x.contextPlayer.fillStyle="#FF7F00",x.contextPlayer.fillText("Game Over",.3*x.width,.42*x.height),x.contextPlayer.font="bold "+.06*x.width+"px "+x.font,x.contextPlayer.fillText(x.score+" enemy ships destroyed",.19*x.width,.52*x.height),x.contextPlayer.font="bold "+.04*x.width+"px "+x.font,x.contextPlayer.fillStyle="white",navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?x.contextPlayer.fillText("Tap screen to restart",.3*x.width,.62*x.height):x.contextPlayer.fillText("Press Enter or LMB to restart",.23*x.width,.62*x.height),"ON"==x.soundStatus&&x.deathSound.play(),x.levelScore=0),x.gameOver&&x.paused&&x.lives>=1&&(x.contextPlayer.font="bold "+.06*x.width+"px "+x.font,x.contextPlayer.fillStyle="#FFD455",x.contextPlayer.fillText("Your ship has been Destroyed!",.11*x.width,.45*x.height),x.contextPlayer.font="bold "+.04*x.width+"px "+x.font,x.contextPlayer.fillText("("+x.lives+" ships left)",.4*x.width,.52*x.height),x.contextPlayer.fillStyle="white",navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?x.contextPlayer.fillText("Tap screen to continue",.3*x.width,.58*x.height):x.contextPlayer.fillText("Press Enter or LMB to continue",.22*x.width,.62*x.height),x.levelScore=0)},1e3)}function t(){for(var a=0;600>a;a++)x.stars.push({x:Math.floor(Math.random()*x.width),y:Math.floor(Math.random()*x.height),size:Math.random()*x.width*.003,image:Math.floor(6*Math.random()+14)});for(var b=0;b<x.level;b++)for(var c=0;c<x.level;c++)x.enemies.push({x:.15*x.width+.15*c*x.width,y:.1*x.height+b*x.player.size,size:.06*x.height,image:1,dead:!1,deadTime:60});u()}function u(){requestAnimFrame(u),a(),x.paused||(b(),c())}function v(a){x.requiredImages=a.length;for(var b in a){var c=new Image;c.src=a[b],x.images[b]=c,x.images[b].onload=function(){x.doneImages++}}}function w(){x.doneImages>=x.requiredImages?(x.contextBackground.clearRect(0,0,x.width,x.height),x.contextBackground.font="bold "+.11*x.width+"px "+x.font,x.contextBackground.fillStyle="purple",x.contextBackground.fillText(X_Title,.2*x.width,.4*x.height),x.contextBackground.font="bold "+.04*x.width+"px "+x.font,x.contextBackground.fillStyle="#FFD455",x.contextBackground.fillText(X_Subtitle,.1*x.width,.55*x.height),x.contextBackground.fillStyle="white",navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?x.contextBackground.fillText(X_mb_Start,.25*x.width,.65*x.height):x.contextBackground.fillText(X_dt_Start,.1*x.width,.7*x.height),t()):setTimeout(function(){w()},1)}window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status==window.applicationCache.UPDATEREADY&&confirm("A new version of InVaDeRs is available. Load it?")&&window.location.reload()},!1)},!1),window.addEventListener("load",d,!1),$.ajax({type:"GET",url:"game.xml",dataType:"xml",async:!1,success:function(a){$(a).find("data").each(function(){X_Sound=parseInt($(this).find("sound").text()),X_Level=parseInt($(this).find("level").text()),X_Lives=parseInt($(this).find("player-lives").text()),X_PlayerSpeed=parseInt($(this).find("player-speed").text()),X_EnemySpeed=parseInt($(this).find("enemy-speed").text()),X_GunSpeed=parseInt($(this).find("reload-time").text()),X_EnGunSpeed=parseInt($(this).find("enreload-time").text()),X_BulletSpeed=parseInt($(this).find("bullet-speed").text()),X_EnBulletSpeed=parseInt($(this).find("enbullet-speed").text()),X_Title=$(this).find("title").text(),X_Subtitle=$(this).find("subtitle").text(),X_dt_Start=$(this).find("dt-start").text(),X_mb_Start=$(this).find("mb-start").text()})},error:function(){alert("The XML File could not be processed correctly.")}});var x={};x.stars=[],x.score=0,x.levelScore=0,x.level=X_Level,x.lives=X_Lives,x.keys=[],x.projectiles=[],x.enprojectiles=[],x.enemies=[],x.explosions=[],x.start=!0,x.paused=!0,x.gameWon=!1,x.gameOver=!1,x.delayTimer=0,x.sound=X_Sound,x.enemyexplodeSound=new Audio("_sounds/explosion.wav"),x.playerexplodeSound=new Audio("_sounds/blast.mp3"),x.shootSound=new Audio("_sounds/laser.wav"),x.deathSound=new Audio("_sounds/death.mp3"),x.winSound=new Audio("_sounds/victory.mp3"),x.images=[],x.doneImages=0,x.requiredImages=0,x.font=navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?"Helvetica":"Monaco",x.contextBackground=document.getElementById("backgroundCanvas").getContext("2d"),x.contextEnemies=document.getElementById("enemiesCanvas").getContext("2d"),x.contextPlayer=document.getElementById("playerCanvas").getContext("2d"),x.contextText=document.getElementById("textCanvas").getContext("2d"),$(document).ready(function(){function a(){b.attr("width",$(f).width()),b.attr("height",$(f).height()),c.attr("width",$(f).width()),c.attr("height",$(f).height()),d.attr("width",$(f).width()),d.attr("height",$(f).height()),e.attr("width",$(f).width()),e.attr("height",.1*$(f).height()),x.width=$(f).width(),x.height=$(f).height(),x.player={x:.46*x.width,y:.9*x.height,size:.08*x.height,speed:X_PlayerSpeed,bulletspeed:X_BulletSpeed*x.height/1e3,image:0,rendered:!1,crashed:!1},x.enemySpeed=X_EnemySpeed*x.height/2500,x.EnBulletSpeed=X_EnBulletSpeed*x.height/1e3,x.downCount=1,x.downDivision=600,x.left=!1,x.down=!1,x.fullShootTimer=X_GunSpeed,x.enfullShootTimer=X_EnGunSpeed,x.shootTimer=x.fullShootTimer,x.enshootTimer=x.enfullShootTimer,x.contextBackground.font="bold "+.08*x.width+"px "+x.font,x.contextBackground.fillStyle="white",x.contextBackground.fillText("Loading...",.3*x.width,.47*x.height)}var b=$("#backgroundCanvas"),c=$("#enemiesCanvas"),d=$("#playerCanvas"),e=$("#textCanvas"),f=(b.get(0).getContext("2d"),$(b).parent());$(window).resize(a),a()}),$(document).keydown(function(a){x.keys[a.keyCode?a.keyCode:a.which]=!0}),$(document).keyup(function(a){delete x.keys[a.keyCode?a.keyCode:a.which]});var y,z,A,B,C=0,D=A;v(["_img/_dist/fighter/fighter.png","_img/_dist/enemy.png","_img/_dist/laser.png","_img/_dist/explosion.png","_img/_dist/fighter/fighter_right1.png","_img/_dist/fighter/fighter_right2.png","_img/_dist/fighter/fighter_right3.png","_img/_dist/fighter/fighter_right4.png","_img/_dist/fighter/fighter_right5.png","_img/_dist/fighter/fighter_left1.png","_img/_dist/fighter/fighter_left2.png","_img/_dist/fighter/fighter_left3.png","_img/_dist/fighter/fighter_left4.png","_img/_dist/fighter/fighter_left5.png","_img/_dist/stars/star1.png","_img/_dist/stars/star2.png","_img/_dist/stars/star3.png","_img/_dist/stars/star4.png","_img/_dist/stars/star5.png","_img/_dist/stars/star6.png","_img/_dist/missile.png"]),w()})}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}();