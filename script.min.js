(function(e){$(document).ready(function(){function _(){C=document.getElementById("playerCanvas");k=C.getContext("2d");C.addEventListener("mousedown",H,false);C.addEventListener("mouseup",D,false);C.addEventListener("mousemove",j,false);C.addEventListener("touchstart",B,false);C.addEventListener("touchend",P,false);C.addEventListener("touchcancel",P,false);C.addEventListener("touchleave",P,false);C.addEventListener("touchmove",F,false)}function D(){O=0;j()}function P(){O=0}function H(){O=1;j()}function B(){O=1;F()}function j(e){if(e){e.preventDefault();L=e.pageX-C.offsetLeft;A=e.pageY-C.offsetTop}}function F(e){if(e){e.preventDefault();L=e.targetTouches[0].pageX-C.offsetLeft;A=e.targetTouches[0].pageY-C.offsetTop}}function I(){for(i=0;i<600;i++){N.stars.push({x:Math.floor(Math.random()*N.width),y:Math.floor(Math.random()*N.height),size:Math.random()*N.width*.003,image:Math.floor(Math.random()*(19-14+1)+14)})}for(y=0;y<N.level;y++){for(x=0;x<N.level;x++){N.enemies.push({x:N.width*.15+x*N.width*.15,y:N.height*.1+y*N.player.height,width:N.height*.06,height:N.height*.06,image:1,dead:false,deadTime:20})}}z()}function q(){if((N.keys[13]||O)&&N.start&&!N.gameOver&&!N.gameWon){N.paused=false;N.start=false;O=0;K()}if(N.keys[27]){N.lives=0}if(N.keys[119]){N.sound=N.sound?false:true;N.keys[119]=false;K()}if(N.keys[80]&&!N.gameWon&&!N.gameOver){N.paused=N.paused?false:true;N.keys[80]=false}if(N.keys[27]||(N.keys[13]||O)&&N.paused&&!N.start&&N.gameOver&&!N.gameWon||(N.keys[13]||O)&&N.paused&&!N.start&&N.level>=7){O=0;N.gameOver=false;N.gameWon=false;if(N.lives<1||N.level>=7){N.level=parseInt(a[0].textContent.toString());N.score=0;N.lives=parseInt(f[0].textContent.toString());N.downDivision=Math.floor(300*N.level);N.leftDivision=parseInt(N.width*.25-N.width*.035*N.level)}N.downCount=1;N.leftCount=1;N.left=false;N.enfullShootTimer=parseInt(v[0].textContent.toString())*N.enemies.length/(N.level*N.enemies.length/2);N.enshootTimer=N.enfullShootTimer;N.down=false;N.contextBackground.clearRect(1,1,N.width,N.height);N.contextPlayer.clearRect(1,1,N.width,N.height);N.contextEnemies.clearRect(1,1,N.width,N.height);N.contextText.clearRect(1,1,N.width,N.height);N.projectiles=[];N.enprojectiles=[];N.enemies=[];for(y=0;y<N.level;y++){for(x=0;x<N.level;x++){N.enemies.push({x:N.width*.05+x*N.width*.15,y:N.height*.1+y*N.player.height,width:N.height*.06,height:N.height*.06,image:1,dead:false,deadTime:20})}}N.player={x:N.width*.46,y:N.height*.9,width:N.height*.08,height:N.height*.08,speed:parseInt(l[0].textContent.toString()),image:0,rendered:false,crashed:false};N.paused=false;K()}if((N.keys[13]||O)&&!N.gameOver&&!N.start&&N.gameWon&&N.level<=6){O=0;N.gameWon=false;N.downCount=1;N.leftCount=1;N.downDivision=Math.floor(300*N.level);N.leftDivision=parseInt(N.width*.25-N.width*.035*N.level);N.left=false;N.down=false;N.enfullShootTimer=parseInt(v[0].textContent.toString())/N.level;N.enshootTimer=N.enfullShootTimer;N.contextBackground.clearRect(1,1,N.width,N.height);N.contextPlayer.clearRect(1,1,N.width,N.height);N.contextEnemies.clearRect(1,1,N.width,N.height);N.contextText.clearRect(1,1,N.width,N.height);N.projectiles=[];N.enprojectiles=[];N.enemies=[];for(y=0;y<N.level;y++){for(x=0;x<N.level;x++){N.enemies.push({x:N.width*.05+x*N.width*.15,y:N.height*.1+y*N.player.height,width:N.height*.06,height:N.height*.06,image:1,dead:false,deadTime:20})}}N.player={x:N.width*.46,y:N.height*.9,width:N.height*.08,height:N.height*.08,speed:parseInt(l[0].textContent.toString()),image:0,rendered:false,crashed:false};N.paused=false;K()}}function R(){X(1);if(N.leftCount>1e5)N.leftCount=0;if(N.downCount>1e5)N.downCount=0;N.downCount++;N.leftCount++;if(N.shootTimer>0)N.shootTimer--;if(N.enshootTimer>0)N.enshootTimer--;for(i in N.stars){if(N.stars[i].y<=-5){N.stars.splice(i,1)}N.stars[i].y--}if(O&&!N.paused&&!N.gameOver&&!N.gameWon){if(L>N.player.width/4&&L<=N.width-N.player.width/4&&A>N.player.height&&A<=N.height-N.player.height/6){moveRight1=L>M&&L<=M+2?true:false;moveRight2=L>M+2&&L<=M+4?true:false;moveRight3=L>M+4&&L<=M+6?true:false;moveRight4=L>M+6&&L<=M+8?true:false;moveRight5=L>M+8?true:false;moveLeft1=L<M&&L>=M-2?true:false;moveLeft2=L<M-2&&L>=M-4?true:false;moveLeft3=L<M-4&&L>=M-6?true:false;moveLeft4=L<M-6&&L>=M-8?true:false;moveLeft5=L<M-8?true:false;N.player.x=L-N.player.width/2;N.player.y=A-N.player.height*1.2;if(moveRight1){N.player.image=4}else if(moveRight2){N.player.image=5}else if(moveRight3){N.player.image=6}else if(moveRight4){N.player.image=7}else if(moveRight5){N.player.image=8}else if(moveLeft1){N.player.image=9}else if(moveLeft2){N.player.image=10}else if(moveLeft3){N.player.image=11}else if(moveLeft4){N.player.image=12}else if(moveLeft5){N.player.image=13}else{N.player.image=0}N.player.rendered=false;M=L}}if(!O&&!N.gameOver){N.player.image=0;N.player.rendered=false}if(N.keys[37]||N.keys[65]&&!N.gameOver&&!N.gameWon){if(N.player.x>N.player.width/50){N.player.x-=N.player.speed;N.player.rendered=false}}if(N.keys[39]||N.keys[68]&&!N.gameOver&&!N.gameWon){if(N.player.x<=N.width-N.player.width){N.player.x+=N.player.speed;N.player.rendered=false}}if(N.keys[38]||N.keys[87]&&!N.gameOver&&!N.gameWon){if(N.player.y>N.player.height/12){N.player.y-=N.player.speed;N.player.rendered=false}}if(N.keys[40]||N.keys[83]&&!N.gameOver&&!N.gameWon){if(N.player.y<=N.height-N.player.height){N.player.y+=N.player.speed;N.player.rendered=false}}if(N.leftCount%N.leftDivision==0){N.left=!N.left}if(N.downCount%N.downDivision==0){N.down=true}for(i in N.enemies){if(!N.down){if(N.left){N.enemies[i].x-=N.enemySpeed}else{N.enemies[i].x+=N.enemySpeed}}if(N.down){N.enemies[i].y+=N.enemySpeed}if(N.enemies[i].y>=N.height-N.player.height&&!N.gameOver){N.player.rendered=false;N.player.image=3;if(N.soundStatus=="ON"){N.playerexplodeSound.play()}N.lives--;N.score=N.score-N.levelScore;N.gameOver=true;N.paused=true;O=0}if(Q(N.enemies[i],N.player)&&!N.gameOver){N.player.rendered=false;N.player.image=3;if(N.soundStatus=="ON"){N.playerexplodeSound.play()}N.lives--;N.score=N.score-N.levelScore;N.gameOver=true;N.paused=true;O=0}}for(i in N.projectiles){N.projectiles[i].y-=parseInt(g[0].textContent.toString())*N.height/1e3;if(N.projectiles[i].y<=-N.projectiles[i].size*2){N.projectiles.splice(i,1)}}for(c in N.enprojectiles){N.enprojectiles[c].y+=parseInt(b[0].textContent.toString())*N.height/1e3;if(N.enprojectiles[c].y>=N.height+N.height*.05){N.enprojectiles.splice(c,1)}}if(N.enemies.length>0&&N.enshootTimer<=0&&!N.paused){J();N.enshootTimer=N.enfullShootTimer}if((N.keys[32]||O)&&N.shootTimer<=0&&!N.paused){V();if(N.soundStatus=="ON"){N.shootSound.play()}N.shootTimer=N.fullShootTimer}for(m in N.enemies){for(p in N.projectiles){if(Q(N.enemies[m],N.projectiles[p])){if(N.soundStatus=="ON"){N.enemyexplodeSound.play()}N.enemies[m].dead=true;N.score++;N.levelScore++;N.enemies[m].image=3;N.contextEnemies.clearRect(N.projectiles[p].x,N.projectiles[p].y,N.projectiles[p].size,N.projectiles[p].size*1.8);N.projectiles.splice(p,1);K()}}}for(n in N.enprojectiles){if(Q(N.player,N.enprojectiles[n])&&!N.gameOver){N.player.rendered=false;N.player.image=3;if(N.soundStatus=="ON"){N.playerexplodeSound.play()}N.lives--;N.score=N.score-N.levelScore;N.gameOver=true;N.paused=true;O=0;N.enprojectiles.splice(n,1)}}for(i in N.enemies){if(N.enemies[i].dead){N.enemies[i].deadTime--}if(N.enemies[i].dead&&N.enemies[i].deadTime<=0){N.contextEnemies.clearRect(N.enemies[i].x-N.enemies[i].width*.1,N.enemies[i].y-N.enemies[i].height*.1,N.enemies[i].width*2.1,N.enemies[i].height*2.1);N.enemies.splice(i,1)}}if(N.enemies.length<=0&&!N.gameOver&&!N.gameWon){if(N.delayTimer<50){N.delayTimer++;if(N.delayTimer>=50){if(N.soundStatus=="ON"){N.winSound.play()}N.level++;N.gameWon=true;N.paused=true;N.delayTimer=0;O=0}}}}function U(){N.font=navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)?"Helvetica":"Monaco";N.contextBackground.clearRect(0,0,N.width,N.height);for(i in N.stars){var e=N.stars[i];N.contextBackground.drawImage(N.images[e.image],e.x,e.y,e.size,e.size)}if(!N.player.rendered){N.contextPlayer.clearRect(0,0,N.width,N.height);N.contextPlayer.drawImage(N.images[N.player.image],N.player.x,N.player.y,N.player.width,N.player.height);N.player.rendered=true}for(i in N.enemies){var t=N.enemies[i];N.contextEnemies.clearRect(t.x-t.width*.1,t.y-t.height*.1,t.width*1.8,t.height*1.1);N.contextEnemies.drawImage(N.images[t.image],t.x,t.y,t.width,t.height)}for(i in N.projectiles){var n=N.projectiles[i];N.contextEnemies.clearRect(n.x,n.y,n.size,n.size*1.8);N.contextEnemies.drawImage(N.images[n.image],n.x,n.y,n.size,n.size)}for(i in N.enprojectiles){var r=N.enprojectiles[i];N.contextEnemies.clearRect(r.x,r.y-r.size*.5,r.size,r.size);N.contextEnemies.drawImage(N.images[r.image],r.x,r.y,r.size,r.size)}if(N.gameOver&&N.lives<1){N.contextPlayer.font="bold "+N.width*.08+"px "+N.font;N.contextPlayer.fillStyle="#FF7F00";N.contextPlayer.fillText("Game Over",N.width*.3,N.height*.42);N.contextPlayer.font="bold "+N.width*.06+"px "+N.font;N.contextPlayer.fillText(N.levelScore+" enemy ships destroyed",N.width*.19,N.height*.52);N.contextPlayer.font="bold "+N.width*.04+"px "+N.font;N.contextPlayer.fillStyle="white";if(navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)){N.contextPlayer.fillText("Tap screen to restart",N.width*.3,N.height*.62)}else{N.contextPlayer.fillText("Press Enter or LMB to restart",N.width*.23,N.height*.62)}if(N.soundStatus=="ON"){N.deathSound.play()}N.levelScore=0}if(N.gameOver&&N.lives>=1){N.contextPlayer.font="bold "+N.width*.06+"px "+N.font;N.contextPlayer.fillStyle="#FFD455";N.contextPlayer.fillText("Your ship has been Destroyed!",N.width*.11,N.height*.45);N.contextPlayer.font="bold "+N.width*.04+"px "+N.font;N.contextPlayer.fillText("("+N.lives+" ships left)",N.width*.4,N.height*.52);N.contextPlayer.fillStyle="white";if(navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)){N.contextPlayer.fillText("Tap screen to continue",N.width*.3,N.height*.58)}else{N.contextPlayer.fillText("Press Enter or LMB to continue",N.width*.22,N.height*.62)}N.levelScore=0}if(N.gameWon&&N.level>1&&N.level<=6){N.contextPlayer.font="bold "+N.width*.08+"px "+N.font;N.contextPlayer.fillStyle="#FFD455";N.contextPlayer.fillText("Battle Won!",N.width*.3,N.height*.42);N.contextPlayer.font="bold "+N.width*.06+"px "+N.font;N.contextPlayer.fillText(N.levelScore+" enemy ships destroyed",N.width*.19,N.height*.52);N.contextPlayer.font="bold "+N.width*.04+"px "+N.font;N.contextPlayer.fillStyle="white";if(navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)){N.contextPlayer.fillText("Tap screen to continue",N.width*.3,N.height*.62)}else{N.contextPlayer.fillText("Press Enter or LMB to continue",N.width*.23,N.height*.62)}N.levelScore=0}if(N.gameWon&&N.level>=7){N.contextPlayer.font="bold "+N.width*.08+"px "+N.font;N.contextPlayer.fillStyle="#CC99FF";N.contextPlayer.fillText("Victory!",N.width*.35,N.height*.42);N.contextPlayer.font="bold "+N.width*.06+"px "+N.font;N.contextPlayer.fillText(N.levelScore+" enemy ships destroyed",N.width*.17,N.height*.52);N.contextPlayer.font="bold "+N.width*.04+"px "+N.font;N.contextPlayer.fillStyle="white";if(navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)){N.contextPlayer.fillText("Tap screen to restart",N.width*.3,N.height*.62)}else{N.contextPlayer.fillText("Press Enter or LMB to restart",N.width*.24,N.height*.62)}N.levelScore=0}}function z(){requestAnimFrame(z);q();if(!N.paused){R();U()}}function W(e){N.requiredImages=e.length;for(i in e){var t=new Image;t.src=e[i];N.images[i]=t;N.images[i].onload=function(){N.doneImages++}}}function X(e){for(i=0;i<e;i++){N.stars.push({x:Math.floor(Math.random()*N.width),y:N.height+10,size:Math.random()*N.width*.003,image:Math.floor(Math.random()*(19-14+1)+14)})}}function V(){N.projectiles.push({x:N.player.x+N.player.width*.42,y:N.player.y,size:N.height*.012,image:2})}function J(){xEn=N.enemies.length;pEn=xEn<2?0:Math.floor(Math.random()*(xEn-1+1));N.enprojectiles.push({x:N.enemies[pEn].x+N.enemies[pEn].width*.42,y:N.enemies[pEn].y+N.enemies[pEn].height,size:N.height*.012,image:2})}function K(){N.contextText.fillStyle="#FFD455";N.contextText.font=N.height*.025+"px helvetica";N.contextText.clearRect(0,0,N.width,N.height*.1);N.contextText.fillText("Level: "+N.level,N.height*.03,N.height*.04);N.contextText.fillText("Score: "+N.score,N.height*.15,N.height*.04);N.soundStatus=N.sound?"ON":"OFF";if(!navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)){N.contextText.fillText("Sound(F8): "+N.soundStatus,N.width-N.height*.45,N.height*.04)}N.contextText.fillText("Hangar: ",N.width-N.height*.22,N.height*.04);for(i=0;i<N.lives;i++){N.contextText.drawImage(N.images[0],i*N.height*.03+N.width-N.height*.12,N.height*.015,N.height*.035,N.height*.035)}}function Q(e,t){return!(e.x>t.x+t.size||e.x+e.width<t.x||e.y>t.y+t.size||e.y+e.height<t.y)}function G(){if(N.doneImages>=N.requiredImages){N.contextBackground.clearRect(0,0,N.width,N.height);N.contextBackground.font="bold "+N.width*.12+"px "+N.font;N.contextBackground.fillStyle="purple";N.contextBackground.fillText(w[0].textContent.toString(),N.width*.215,N.height*.4);N.contextBackground.font="bold "+N.width*.06+"px "+N.font;N.contextBackground.fillStyle="#FFD455";N.contextBackground.fillText(E[0].textContent.toString(),N.width*.08,N.height*.5);N.contextBackground.fillStyle="white";if(navigator.userAgent.match(/(iPod|iPhone|iPad|Android)/)){N.contextBackground.fillText(T[0].textContent.toString(),N.width*.26,N.height*.6)}else{N.contextBackground.fillText(S[0].textContent.toString(),N.width*.14,N.height*.65)}I()}else{setTimeout(function(){G()},1)}}window.addEventListener("load",function(e){window.applicationCache.addEventListener("updateready",function(e){if(window.applicationCache.status==window.applicationCache.UPDATEREADY){if(confirm("A new version of InVaDeRs is available. Load it?")){window.location.reload()}}else{}},false)},false);window.addEventListener("load",_,false);var e=new XMLHttpRequest;e.open("GET","game.xml",false);e.setRequestHeader("Content-Type","text/xml");e.send(null);var t=e.responseXML;var r=t.childNodes[0];var s=r.children[0];var o=r.children[1];var u=s.getElementsByTagName("sound");var a=s.getElementsByTagName("level");var f=s.getElementsByTagName("player-lives");var l=s.getElementsByTagName("player-speed");var h=s.getElementsByTagName("enemy-speed");var d=s.getElementsByTagName("reload-time");var v=s.getElementsByTagName("enreload-time");var g=s.getElementsByTagName("bullet-speed");var b=s.getElementsByTagName("enbullet-speed");var w=o.getElementsByTagName("title");var E=o.getElementsByTagName("subtitle");var S=o.getElementsByTagName("dt-start");var T=o.getElementsByTagName("mb-start");var N={};N.stars=[];N.score=0;N.levelScore=0;N.level=parseInt(a[0].textContent.toString());N.lives=parseInt(f[0].textContent.toString());N.keys=[];N.projectiles=[];N.enprojectiles=[];N.enemies=[];N.sound=parseInt(u[0].textContent.toString());N.enemyexplodeSound=new Audio("_sounds/explosion.wav");N.playerexplodeSound=new Audio("_sounds/blast.mp3");N.shootSound=new Audio("_sounds/laser.wav");N.deathSound=new Audio("_sounds/death.mp3");N.winSound=new Audio("_sounds/victory.mp3");N.images=[];N.doneImages=0;N.requiredImages=0;N.start=true;N.paused=true;N.gameWon=false;N.gameOver=false;N.delayTimer=0;N.contextBackground=document.getElementById("backgroundCanvas").getContext("2d");N.contextEnemies=document.getElementById("enemiesCanvas").getContext("2d");N.contextPlayer=document.getElementById("playerCanvas").getContext("2d");N.contextText=document.getElementById("textCanvas").getContext("2d");$(document).ready(function(){function o(){e.attr("width",$(s).width());e.attr("height",$(s).height());t.attr("width",$(s).width());t.attr("height",$(s).height());n.attr("width",$(s).width());n.attr("height",$(s).height());r.attr("width",$(s).width());r.attr("height",$(s).height()*.1);N.width=$(s).width();N.height=$(s).height();N.player={x:N.width*.46,y:N.height*.9,width:N.height*.08,height:N.height*.08,speed:parseInt(l[0].textContent.toString()),image:0,rendered:false,crashed:false};N.enemySpeed=parseInt(h[0].textContent.toString())*N.height/2500;N.leftCount=1;N.downCount=1;N.downDivision=600;N.leftDivision=parseInt(N.width*.2);N.left=false;N.down=false;N.fullShootTimer=parseInt(d[0].textContent.toString());N.enfullShootTimer=parseInt(v[0].textContent.toString());N.shootTimer=N.fullShootTimer;N.enshootTimer=N.enfullShootTimer}var e=$("#backgroundCanvas");var t=$("#enemiesCanvas");var n=$("#playerCanvas");var r=$("#textCanvas");var i=e.get(0).getContext("2d");var s=$(e).parent();$(window).resize(o);o()});$(document).keydown(function(e){N.keys[e.keyCode?e.keyCode:e.which]=true});$(document).keyup(function(e){delete N.keys[e.keyCode?e.keyCode:e.which]});var C;var k;var L;var A;var O=0;var M=L;N.contextBackground.font="bold "+N.width*.08+"px "+N.font;N.contextBackground.fillStyle="white";N.contextBackground.fillText("loading...",N.width*.3,N.height*.47);W(["_img/fighter/fighter.png","_img/enemy.png","_img/bullet.png","_img/explosion.png","_img/fighter/fighter_right1.png","_img/fighter/fighter_right2.png","_img/fighter/fighter_right3.png","_img/fighter/fighter_right4.png","_img/fighter/fighter_right5.png","_img/fighter/fighter_left1.png","_img/fighter/fighter_left2.png","_img/fighter/fighter_left3.png","_img/fighter/fighter_left4.png","_img/fighter/fighter_left5.png","_img/stars/star1.png","_img/stars/star2.png","_img/stars/star3.png","_img/stars/star4.png","_img/stars/star5.png","_img/stars/star6.png"]);G()})})();window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}()